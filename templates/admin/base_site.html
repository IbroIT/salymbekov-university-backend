{% extends "admin/base.html" %}

{% load static %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/custom_admin.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/advanced_admin.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    
    <style>
        :root {
            --university-primary: #1e40af;
            --university-secondary: #3b82f6;
            --university-accent: #60a5fa;
            --university-dark: #1e3a8a;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ */
        #branding::before {
            content: "üéì";
            font-size: 28px;
            margin-right: 12px;
            display: inline-block;
            vertical-align: middle;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--university-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .messagelist li {
            border-radius: 8px;
            margin: 10px 0;
            padding: 15px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
{% endblock %}

{% block title %}- {{ title|default:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å" }}{% endblock %}

{% block branding %}
    <div id="branding">
        <h1 id="site-name">
            <a href="{% url 'admin:index' %}">
                Salymbekov University
            </a>
        </h1>
        <div class="site-subtitle">
            <i class="fas fa-cog"></i> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å
        </div>
    </div>
{% endblock %}

{% block nav-global %}
    <!-- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="nav-global">
        <a target="_blank"  class="nav-link"><i class="fas fa-home"></i> –ù–∞ —Å–∞–π—Ç</a>
        <a href="/admin/statistics/" class="nav-link"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </div>
{% endblock %}

{% block footer %}
    <div id="footer">
        <div class="footer-content">
            <p class="copyright">
                ¬© {{ "now"|date:"Y" }} –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –°–∞–ª—ã–º–±–µ–∫–æ–≤–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
            </p>
            <p class="version">
                <i class="fas fa-code-branch"></i> –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º v2.1
            </p>
            <div class="footer-links">
                <a href="/admin/help/"><i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å</a>
                <a href="/admin/support/"><i class="fas fa-headset"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
                    if (!form.checkValidity()) {
                        e.preventDefault();
                        form.reportValidity();
                        return;
                    }
                    
                    const loading = document.createElement('div');
                    loading.className = 'loading-overlay';
                    loading.innerHTML = '<div class="loading-spinner"></div>';
                    document.body.appendChild(loading);
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫
                    setTimeout(() => {
                        loading.classList.add('hidden');
                        setTimeout(() => loading.remove(), 300);
                    }, 10000);
                });
            });
            
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é
            const currentPath = window.location.pathname;
            const menuLinks = document.querySelectorAll('#nav-sidebar a, .nav-global a');
            menuLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                    // –¢–∞–∫–∂–µ –ø–æ–º–µ—á–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    let parent = link.closest('.module');
                    if (parent) parent.classList.add('active-module');
                }
            });
            
            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
            const focusableElements = document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"], textarea, select');
            for (let el of focusableElements) {
                if (el && !el.readOnly && !el.disabled && el.offsetParent !== null) {
                    el.focus();
                    break;
                }
            }
            
            // –ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∞–≤–∏—à–∏
            document.addEventListener('keydown', function(e) {
                // Ctrl + S –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    const saveBtn = document.querySelector('input[type="submit"][name="_save"], input[type="submit"][value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"]');
                    if (saveBtn) saveBtn.click();
                }
                
                // Escape –¥–ª—è –æ—Ç–º–µ–Ω—ã
                if (e.key === 'Escape') {
                    const cancelBtn = document.querySelector('input[type="submit"][name="_addanother"], .cancel-link');
                    if (cancelBtn) cancelBtn.click();
                }
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è AJAX-–¥–µ–π—Å—Ç–≤–∏–π
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const loading = document.createElement('div');
                loading.className = 'loading-overlay';
                loading.innerHTML = '<div class="loading-spinner"></div>';
                document.body.appendChild(loading);
                
                return originalFetch.apply(this, args).finally(() => {
                    loading.classList.add('hidden');
                    setTimeout(() => loading.remove(), 300);
                });
            };
        });
    </script>
{% endblock %}